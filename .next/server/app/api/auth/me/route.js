"use strict";(()=>{var e={};e.id=788,e.ids=[788],e.modules={9344:e=>{e.exports=require("jsonwebtoken")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5819:e=>{e.exports=import("@azure/cosmos")},7618:e=>{e.exports=import("bcryptjs")},5404:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>l,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var a=r(9303),i=r(8716),s=r(670),o=r(193),c=e([o]);o=(c.then?(await c)():c)[0];let u=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/me/route",pathname:"/api/auth/me",filename:"route",bundlePath:"app/api/auth/me/route"},resolvedPagePath:"C:\\Users\\puspa\\OneDrive\\Documents\\Work\\luxylyfe_project\\app\\api\\auth\\me\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:m}=u,y="/api/auth/me/route";function l(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}n()}catch(e){n(e)}})},193:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{GET:()=>c,dynamic:()=>l});var a=r(7070),i=r(4544),s=r(9178),o=e([i,s]);[i,s]=o.then?(await o)():o;let l="force-dynamic";async function c(e){try{let t;console.log("=== /api/auth/me called ===");let r=e.cookies.get("auth-token")?.value;if(console.log("Token from cookie:",r?`Present (${r.length} chars)`:"Missing"),!r)return console.log("No token found in cookies"),a.NextResponse.json({error:"No authentication token found"},{status:401});console.log("Verifying JWT token...");try{t=(0,s.WX)(r),console.log("JWT decoded successfully:",{userId:t.userId,email:t.email,role:t.role})}catch(e){return console.log("JWT verification failed:",e instanceof Error?e.message:String(e)),a.NextResponse.json({error:"Invalid or expired token"},{status:401})}console.log("Looking up session by token...");let n=await i.db.session.findUnique({token:r});if(console.log("Session found:",n?"Yes":"No"),!n)return console.log("Session not found in database"),a.NextResponse.json({error:"Invalid or expired session"},{status:401});let o=new Date(n.expiresAt),c=new Date;if(console.log("Session expires at:",o.toISOString()),console.log("Current time:",c.toISOString()),console.log("Session expired?",o<=c),o<=c){console.log("Session is expired");try{await i.db.session.delete({id:n.id}),console.log("Expired session deleted")}catch(e){console.log("Failed to delete expired session:",e)}return a.NextResponse.json({error:"Session expired"},{status:401})}console.log("Looking up user by ID:",n.userId);let l=await i.db.user.findUnique({email:t.email});if(console.log("User found by email:",l?"Yes":"No"),!l)return console.log("User not found in database"),a.NextResponse.json({error:"User not found"},{status:401});if(l.id!==n.userId)return console.log("User ID mismatch between session and user record"),a.NextResponse.json({error:"Invalid session"},{status:401});let{password:u,...d}=l;return console.log("Authentication successful for user:",l.email),a.NextResponse.json({user:d,isAuthenticated:!0,sessionExpiresAt:o.toISOString()})}catch(e){return console.error("Session verification error:",e),a.NextResponse.json({error:"Authentication failed",details:e instanceof Error?e.message:String(e)},{status:401})}}n()}catch(e){n(e)}})},9178:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{Gv:()=>l,RA:()=>u,WX:()=>d,c_:()=>c});var a=r(7618),i=r(9344),s=r.n(i),o=e([a]);a=(o.then?(await o)():o)[0];let c=async e=>{let t=parseInt(process.env.BCRYPT_ROUNDS||"12");return await a.default.hash(e,t)},l=async(e,t)=>await a.default.compare(e,t),u=e=>{let t=process.env.JWT_SECRET;if(!t)throw Error("JWT_SECRET is not defined");return s().sign(e,t,{expiresIn:"24h"})},d=e=>{let t=process.env.JWT_SECRET;if(!t)throw Error("JWT_SECRET is not defined");return s().verify(e,t)};n()}catch(e){n(e)}})},4544:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{db:()=>d});var a=r(5819),i=e([a]);a=(i.then?(await i)():i)[0];let l={endpoint:process.env.COSMOS_DB_ENDPOINT,key:process.env.COSMOS_DB_KEY,databaseId:process.env.COSMOS_DB_DATABASE_NAME||"luxylyfe-db"},u=null;function s(){return(function(){if(!u){if(!process.env.COSMOS_DB_ENDPOINT||!process.env.COSMOS_DB_KEY)throw Error("Cosmos DB configuration missing. Please set COSMOS_DB_ENDPOINT and COSMOS_DB_KEY in your environment.");u=new a.CosmosClient({endpoint:l.endpoint,key:l.key})}return u})().database(l.databaseId)}function o(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}function c(e,t=!1){let r=new Date().toISOString();return t||(e.createdAt=r),e.updatedAt=r,e}let d={user:{async create(e){let t=s().container("users"),r={id:o(),...c(e)},{resource:n}=await t.items.create(r);return n},async findUnique(e){let t=s().container("users");if(e.email){let{resources:r}=await t.items.query({query:"SELECT * FROM c WHERE c.email = @email",parameters:[{name:"@email",value:e.email}]}).fetchAll();return r[0]}return null},async findMany(e){let t=s().container("users");if(e?.role){let{resources:r}=await t.items.query({query:"SELECT * FROM c WHERE c.role = @role",parameters:[{name:"@role",value:e.role}]}).fetchAll();return r.sort((e,t)=>new Date(t.createdAt||"").getTime()-new Date(e.createdAt||"").getTime())}let{resources:r}=await t.items.query("SELECT * FROM c").fetchAll();return r.sort((e,t)=>new Date(t.createdAt||"").getTime()-new Date(e.createdAt||"").getTime())},async update(e,t){let r=s().container("users"),n=await this.findUnique(e);if(!n)throw Error("User not found");let a={...n,...c(t,!0)},{resource:i}=await r.item(e.id,e.id).replace(a);return i},async delete(e){let t=s().container("users"),{resource:r}=await t.item(e.id,e.id).delete();return r},async count(e){let t=s().container("users");if(e?.role){let{resources:r}=await t.items.query({query:"SELECT VALUE COUNT(1) FROM c WHERE c.role = @role",parameters:[{name:"@role",value:e.role}]}).fetchAll();return r[0]||0}let{resources:r}=await t.items.query("SELECT VALUE COUNT(1) FROM c").fetchAll();return r[0]||0}},property:{async create(e){let t=s().container("properties"),r={id:o(),...c(e)},{resource:n}=await t.items.create(r);return n},async findUnique(e){let t=s().container("properties");if(e.id)try{let{resource:r}=await t.item(e.id,e.id).read();return r}catch(e){if(404===e.code)return null;throw e}if(e.propertyId){let{resources:r}=await t.items.query({query:"SELECT * FROM c WHERE c.propertyId = @propertyId",parameters:[{name:"@propertyId",value:e.propertyId}]}).fetchAll();return r[0]}return null},async findMany(e){let t=s().container("properties"),r="SELECT * FROM c",n=[];if(e?.isAvailable!==void 0||e?.isFeature!==void 0){let t=[];void 0!==e.isAvailable&&(t.push("c.isAvailable = @isAvailable"),n.push({name:"@isAvailable",value:e.isAvailable})),void 0!==e.isFeature&&(t.push("c.isFeature = @isFeature"),n.push({name:"@isFeature",value:e.isFeature})),r+=" WHERE "+t.join(" AND ")}let{resources:a}=await t.items.query({query:r,parameters:n}).fetchAll();return a.sort((e,t)=>new Date(t.createdAt||"").getTime()-new Date(e.createdAt||"").getTime())},async update(e,t){let r=s().container("properties"),n=await this.findUnique(e);if(!n)throw Error("Property not found");let a={...n,...c(t,!0)},{resource:i}=await r.item(e.id,e.id).replace(a);return i},async delete(e){let t=s().container("properties"),{resource:r}=await t.item(e.id,e.id).delete();return r},async count(){let e=s().container("properties"),{resources:t}=await e.items.query("SELECT VALUE COUNT(1) FROM c").fetchAll();return t[0]||0}},session:{async create(e){let t=s().container("sessions"),r={id:o(),...e,createdAt:new Date().toISOString()},{resource:n}=await t.items.create(r);return n},async findUnique(e){let t=s().container("sessions");if(e.id)try{let{resource:r}=await t.item(e.id,e.id).read();return r}catch(e){if(404===e.code)return null;throw e}if(e.token){let{resources:r}=await t.items.query({query:"SELECT * FROM c WHERE c.token = @token",parameters:[{name:"@token",value:e.token}]}).fetchAll();return r[0]}return null},async findMany(e){let t=s().container("sessions");if(e?.userId){let{resources:r}=await t.items.query({query:"SELECT * FROM c WHERE c.userId = @userId",parameters:[{name:"@userId",value:e.userId}]}).fetchAll();return r.sort((e,t)=>new Date(t.createdAt||"").getTime()-new Date(e.createdAt||"").getTime())}let{resources:r}=await t.items.query("SELECT * FROM c").fetchAll();return r.sort((e,t)=>new Date(t.createdAt||"").getTime()-new Date(e.createdAt||"").getTime())},async delete(e){let t=s().container("sessions"),{resource:r}=await t.item(e.id,e.id).delete();return r},async count(){let e=s().container("sessions"),{resources:t}=await e.items.query("SELECT VALUE COUNT(1) FROM c").fetchAll();return t[0]||0}},loginAttempt:{async create(e){let t=s().container("login_attempts"),r={id:o(),...e,createdAt:new Date().toISOString()},{resource:n}=await t.items.create(r);return n},async findMany(e){let t=s().container("login_attempts");if(e?.email){let{resources:r}=await t.items.query({query:"SELECT * FROM c WHERE c.email = @email",parameters:[{name:"@email",value:e.email}]}).fetchAll();return r.sort((e,t)=>new Date(t.createdAt||"").getTime()-new Date(e.createdAt||"").getTime())}let{resources:r}=await t.items.query("SELECT * FROM c").fetchAll();return r.sort((e,t)=>new Date(t.createdAt||"").getTime()-new Date(e.createdAt||"").getTime())},async count(){let e=s().container("login_attempts"),{resources:t}=await e.items.query("SELECT VALUE COUNT(1) FROM c").fetchAll();return t[0]||0}},pageContent:{async create(e){let t=s().container("page_contents"),r={id:o(),...c(e)},{resource:n}=await t.items.create(r);return n},async findMany(e){let t=s().container("page_contents"),r="SELECT * FROM c",n=[];if(e?.pageType!==void 0||e?.isActive!==void 0){let t=[];void 0!==e.pageType&&(t.push("c.pageType = @pageType"),n.push({name:"@pageType",value:e.pageType})),void 0!==e.isActive&&(t.push("c.isActive = @isActive"),n.push({name:"@isActive",value:e.isActive})),r+=" WHERE "+t.join(" AND ")}let{resources:a}=await t.items.query({query:r,parameters:n}).fetchAll();return a.sort((e,t)=>{let r=e.order||0,n=t.order||0;return r!==n?r-n:new Date(t.createdAt||"").getTime()-new Date(e.createdAt||"").getTime()})},async count(){let e=s().container("page_contents"),{resources:t}=await e.items.query("SELECT VALUE COUNT(1) FROM c").fetchAll();return t[0]||0}},siteSettings:{async create(e){let t=s().container("site_settings"),r={id:o(),...c(e)},{resource:n}=await t.items.create(r);return n},async findUnique(e){let t=s().container("site_settings"),{resources:r}=await t.items.query({query:"SELECT * FROM c WHERE c.key = @key",parameters:[{name:"@key",value:e.key}]}).fetchAll();return r[0]},async findMany(){let e=s().container("site_settings"),{resources:t}=await e.items.query("SELECT * FROM c").fetchAll();return t.sort((e,t)=>(e.key||"").localeCompare(t.key||""))},async count(){let e=s().container("site_settings"),{resources:t}=await e.items.query("SELECT VALUE COUNT(1) FROM c").fetchAll();return t[0]||0}},async $disconnect(){}};n()}catch(e){n(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972],()=>r(5404));module.exports=n})();