"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},6951:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>l});var a=t(9303),o=t(8716),i=t(3131),n=t(7070),u=t(3493),p=t(9178);async function l(e){try{let{email:r,password:t,role:s}=await e.json();if(!r||!t||!s)return n.NextResponse.json({error:"Email, password, and role are required"},{status:400});if("ADMIN"!==s&&"MEMBER"!==s&&"SUPERADMIN"!==s)return n.NextResponse.json({error:"Invalid role specified"},{status:400});let a=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown";try{await u._.loginAttempt.create({data:{email:r,ipAddress:a,success:!1}})}catch(e){console.error("Failed to log login attempt:",e)}let o=await u._.user.findFirst({where:{email:r,role:s}});if(!o||!await (0,p.Gv)(t,o.password))return n.NextResponse.json({error:"Invalid credentials"},{status:401});let i=(0,p.RA)({userId:o.id,email:o.email,role:o.role}),l=new Date;l.setHours(l.getHours()+24),await u._.session.create({data:{userId:o.id,token:i,expiresAt:l}});try{await u._.loginAttempt.updateMany({where:{email:r,ipAddress:a,success:!1},data:{success:!0}})}catch(e){console.error("Failed to update login attempt:",e)}let d=n.NextResponse.json({message:"Login successful",user:{id:o.id,email:o.email,role:o.role,name:o.name}});return d.cookies.set("auth-token",i,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:86400}),d}catch(e){return console.error("Login error:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\puspa\\OneDrive\\Documents\\Work\\luxylyfe_project\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:h}=d,g="/api/auth/login/route";function x(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},9178:(e,r,t)=>{t.d(r,{Gv:()=>n,RA:()=>u,WX:()=>p,c_:()=>i});var s=t(8691),a=t(1482),o=t.n(a);let i=async e=>{let r=parseInt(process.env.BCRYPT_ROUNDS||"12");return await s.ZP.hash(e,r)},n=async(e,r)=>await s.ZP.compare(e,r),u=e=>{let r=process.env.JWT_SECRET;if(!r)throw Error("JWT_SECRET is not defined");return o().sign(e,r,{expiresIn:"24h"})},p=e=>{let r=process.env.JWT_SECRET;if(!r)throw Error("JWT_SECRET is not defined");return o().verify(e,r)}},3493:(e,r,t)=>{t.d(r,{_:()=>a});let s=require("@prisma/client"),a=globalThis.prisma??new s.PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,482,691],()=>t(6951));module.exports=s})();