"use strict";(()=>{var e={};e.id=628,e.ids=[628],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},9219:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>x,routeModule:()=>h,serverHooks:()=>R,staticGenerationAsyncStorage:()=>y});var s={};t.r(s),t.d(s,{GET:()=>m,POST:()=>f});var n=t(9303),a=t(8716),o=t(3131),i=t(7070),u=t(3493),p=t(9178),d=t(1482),l=t.n(d);async function c(e){try{let r=e.cookies.get("auth-token")?.value;if(!r)return null;let t=l().verify(r,process.env.JWT_SECRET),s=await u._.user.findUnique({where:{id:t.userId},select:{id:!0,email:!0,role:!0,name:!0}});if(s?.role!=="SUPERADMIN")return null;return s}catch(e){return null}}async function m(e){try{if(!await c(e))return i.NextResponse.json({error:"Unauthorized. Superadmin access required."},{status:403});let r=await u._.user.findMany({select:{id:!0,email:!0,role:!0,name:!0,phone:!0,propertyAddress:!0,propertyNumber:!0,createdAt:!0,updatedAt:!0},orderBy:{createdAt:"desc"}});return i.NextResponse.json({users:r,message:"Users retrieved successfully"})}catch(e){return console.error("Error fetching users:",e),i.NextResponse.json({error:"Failed to fetch users"},{status:500})}}async function f(e){try{if(!await c(e))return i.NextResponse.json({error:"Unauthorized. Superadmin access required."},{status:403});let{name:r,email:t,phone:s,password:n,role:a,propertyAddress:o,propertyNumber:d}=await e.json();if(!t||!n||!a||!r)return i.NextResponse.json({error:"Name, email, password, and role are required"},{status:400});if(!["SUPERADMIN","ADMIN","MEMBER"].includes(a))return i.NextResponse.json({error:"Invalid role specified"},{status:400});if(n.length<6)return i.NextResponse.json({error:"Password must be at least 6 characters long"},{status:400});if(await u._.user.findUnique({where:{email:t}}))return i.NextResponse.json({error:"A user with this email already exists"},{status:409});let l=await (0,p.c_)(n),m=await u._.user.create({data:{name:r,email:t,phone:s||null,password:l,role:a,propertyAddress:o||null,propertyNumber:d||null},select:{id:!0,email:!0,role:!0,name:!0,phone:!0,propertyAddress:!0,propertyNumber:!0,createdAt:!0}});return i.NextResponse.json({message:"User created successfully",user:m},{status:201})}catch(e){return console.error("Error creating user:",e),i.NextResponse.json({error:"Failed to create user"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"C:\\Users\\puspa\\OneDrive\\Documents\\Work\\luxylyfe_project\\app\\api\\admin\\users\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:y,serverHooks:R}=h,v="/api/admin/users/route";function w(){return(0,o.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:y})}},9178:(e,r,t)=>{t.d(r,{Gv:()=>i,RA:()=>u,WX:()=>p,c_:()=>o});var s=t(8691),n=t(1482),a=t.n(n);let o=async e=>{let r=parseInt(process.env.BCRYPT_ROUNDS||"12");return await s.ZP.hash(e,r)},i=async(e,r)=>await s.ZP.compare(e,r),u=e=>{let r=process.env.JWT_SECRET;if(!r)throw Error("JWT_SECRET is not defined");return a().sign(e,r,{expiresIn:"24h"})},p=e=>{let r=process.env.JWT_SECRET;if(!r)throw Error("JWT_SECRET is not defined");return a().verify(e,r)}},3493:(e,r,t)=>{t.d(r,{_:()=>n});let s=require("@prisma/client"),n=globalThis.prisma??new s.PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,482,691],()=>t(9219));module.exports=s})();