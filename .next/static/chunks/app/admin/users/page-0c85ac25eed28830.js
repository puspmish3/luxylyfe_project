(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{7042:function(e,r,s){Promise.resolve().then(s.bind(s,2573))},2573:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return o}});var a=s(7437),t=s(2265),l=s(6463),d=s(7138);function o(){let[e,r]=(0,t.useState)(null),[s,o]=(0,t.useState)([]),[n,i]=(0,t.useState)(!0),[c,u]=(0,t.useState)(!1),[m,x]=(0,t.useState)(!1),[p,h]=(0,t.useState)(null),[b,g]=(0,t.useState)(""),[f,y]=(0,t.useState)(""),w=(0,l.useRouter)(),[j,N]=(0,t.useState)({name:"",email:"",phone:"",password:"",role:"MEMBER",propertyAddress:"",propertyNumber:""}),[v,P]=(0,t.useState)({userId:"",newPassword:"",confirmPassword:""});(0,t.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me");if(e.ok){let s=await e.json();if("SUPERADMIN"!==s.user.role){w.push("/admin/dashboard");return}r(s.user),await k()}else w.push("/admin-login")}catch(e){console.error("Auth check failed:",e),w.push("/admin-login")}finally{i(!1)}})()},[w]);let k=async()=>{try{let e=await fetch("/api/admin/users");if(e.ok){let r=await e.json();o(r.users)}else g("Failed to load users")}catch(e){console.error("Failed to load users:",e),g("Failed to load users")}},E=async e=>{e.preventDefault(),u(!0),g(""),y("");try{let e=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)}),r=await e.json();e.ok?(y("User ".concat(j.email," created successfully!")),N({name:"",email:"",phone:"",password:"",role:"MEMBER",propertyAddress:"",propertyNumber:""}),await k()):g(r.error||"Failed to create user")}catch(e){console.error("Create user error:",e),g("Failed to create user")}finally{u(!1)}},C=async e=>{if(e.preventDefault(),x(!0),g(""),y(""),v.newPassword!==v.confirmPassword){g("Passwords do not match"),x(!1);return}if(v.newPassword.length<6){g("Password must be at least 6 characters long"),x(!1);return}try{let e=await fetch("/api/admin/users/password",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:v.userId,newPassword:v.newPassword})}),r=await e.json();e.ok?(y("Password updated successfully!"),P({userId:"",newPassword:"",confirmPassword:""}),h(null)):g(r.error||"Failed to update password")}catch(e){console.error("Update password error:",e),g("Failed to update password")}finally{x(!1)}},S=async(e,r)=>{if(confirm("Are you sure you want to delete user ".concat(r,"?")))try{let s=await fetch("/api/admin/users/".concat(e),{method:"DELETE"});if(s.ok)y("User ".concat(r," deleted successfully!")),await k();else{let e=await s.json();g(e.error||"Failed to delete user")}}catch(e){console.error("Delete user error:",e),g("Failed to delete user")}},U=async()=>{try{await fetch("/api/auth/logout",{method:"POST"}),w.push("/")}catch(e){console.error("Logout failed:",e)}};return n?(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,a.jsx)("nav",{className:"bg-white shadow-lg",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex justify-between h-16",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),(0,a.jsx)("span",{className:"bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:"SUPERADMIN"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(d.default,{href:"/admin/dashboard",className:"text-blue-600 hover:text-blue-500",children:"Back to Dashboard"}),(0,a.jsxs)("span",{className:"text-gray-700",children:["Welcome, ",(null==e?void 0:e.name)||(null==e?void 0:e.email)]}),(0,a.jsx)("button",{onClick:U,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:"Logout"})]})]})})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto py-6 px-4",children:[b&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",children:b}),f&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-6",children:f}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Create New User"}),(0,a.jsxs)("form",{onSubmit:E,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,a.jsx)("input",{type:"text",value:j.name,onChange:e=>N({...j,name:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter full name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),(0,a.jsx)("input",{type:"email",value:j.email,onChange:e=>N({...j,email:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter email address"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),(0,a.jsx)("input",{type:"tel",value:j.phone,onChange:e=>N({...j,phone:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter phone number"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role *"}),(0,a.jsxs)("select",{value:j.role,onChange:e=>N({...j,role:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"MEMBER",children:"Member"}),(0,a.jsx)("option",{value:"ADMIN",children:"Admin"}),(0,a.jsx)("option",{value:"SUPERADMIN",children:"Super Admin"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),(0,a.jsx)("input",{type:"password",value:j.password,onChange:e=>N({...j,password:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter password (min. 6 characters)"})]}),"MEMBER"===j.role&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Property Address"}),(0,a.jsx)("textarea",{value:j.propertyAddress,onChange:e=>N({...j,propertyAddress:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter property address"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Property Number/Unit"}),(0,a.jsx)("input",{type:"text",value:j.propertyNumber,onChange:e=>N({...j,propertyNumber:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter property number or unit"})]})]}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Creating User...":"Create User"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Update User Password"}),(0,a.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select User *"}),(0,a.jsxs)("select",{value:v.userId,onChange:e=>{let r=e.target.value;P({...v,userId:r}),h(s.find(e=>e.id===r)||null)},required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Choose a user..."}),s.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name||e.email," (",e.role,")"]},e.id))]})]}),p&&(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"Selected:"})," ",p.name||p.email]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"Role:"})," ",p.role]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password *"}),(0,a.jsx)("input",{type:"password",value:v.newPassword,onChange:e=>P({...v,newPassword:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter new password (min. 6 characters)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password *"}),(0,a.jsx)("input",{type:"password",value:v.confirmPassword,onChange:e=>P({...v,confirmPassword:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Confirm new password"})]}),(0,a.jsx)("button",{type:"submit",disabled:m||!v.userId,className:"w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 focus:ring-4 focus:ring-green-300 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Updating Password...":"Update Password"})]})]})]}),(0,a.jsxs)("div",{className:"mt-8 bg-white rounded-lg shadow",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900",children:["All Users (",s.length,")"]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(r=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:r.name||"No name"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:r.email})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("SUPERADMIN"===r.role?"bg-red-100 text-red-800":"ADMIN"===r.role?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:r.role})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.phone||"No phone"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(r.createdAt).toLocaleDateString()}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{P({...v,userId:r.id}),h(r)},className:"text-blue-600 hover:text-blue-900",children:"Reset Password"}),r.id!==(null==e?void 0:e.id)&&(0,a.jsx)("button",{onClick:()=>S(r.id,r.email),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},r.id))})]})})]})]})]})}},7138:function(e,r,s){"use strict";s.d(r,{default:function(){return t.a}});var a=s(231),t=s.n(a)},6463:function(e,r,s){"use strict";var a=s(1169);s.o(a,"useRouter")&&s.d(r,{useRouter:function(){return a.useRouter}})}},function(e){e.O(0,[231,971,23,744],function(){return e(e.s=7042)}),_N_E=e.O()}]);